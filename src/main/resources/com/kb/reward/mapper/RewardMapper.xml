<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kb.reward.mapper.RewardMapper">
    <insert id="insertReward" parameterType="com.kb.reward.dto.RewardRequest"
    useGeneratedKeys="true" keyProperty="rewardId">
        insert into reward (reward_name, reward_seed)
        values (#{rewardName}, #{rewardSeed});
    </insert>
    <insert id="insertRewardGiveHistory" parameterType="com.kb.reward.dto.RewardGiveRequest">
        insert into reward_give(reward_id, give_date, std_id, tch_id) values (#{rewardId}, now(), #{stdId}, #{tchId});
    </insert>

    <update id="deleteRewardById" parameterType="long">
        update reward set status = 'n' where reward_id = #{rewardId};
    </update>

    <select id="selectRewardList" resultType="com.kb.reward.domain.Reward">
        select * from reward where status = 'y' order by reward_id desc;
    </select>

    <select id="selectRewardById" resultType="com.kb.reward.domain.Reward">
        select * from reward where reward_id = #{rewardId};
    </select>
    <select id="selectStudentsList" resultType="com.kb.reward.dto.RewardStudentDTO">
        select std_id, std_name, seed from student order by std_num;
    </select>
    <select id="selectRewardGiveList" resultType="com.kb.reward.dto.RewardGiveDTO">
        select give_id, DATE_FORMAT(give_date, '%Y-%m-%d') as give_date, s.std_name, r.reward_name, r.reward_seed
        from reward_give g
                 join reward r on r.reward_id = g.reward_id
                 join student s on s.std_id = g.std_id
        order by give_date desc;
    </select>
</mapper>