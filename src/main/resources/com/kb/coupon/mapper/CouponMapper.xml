<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kb.coupon.mapper.CouponMapper">
    <resultMap id="CouponResultMap" type="com.kb.coupon.dto.CouponDTO">
        <id property="cpId" column="cp_id"/>
        <result property="cpName" column="cp_name"/>
        <result property="cpContent" column="cp_content"/>
        <result property="cpQuantity" column="cp_quantity"/>
        <result property="cpPrice" column="cp_price"/>
    </resultMap>

    <select id="selectCoupon" resultMap="CouponResultMap">
        select * from coupon where cp_quantity > 0;
    </select>

    <select id="selectCouponById" parameterType="long" resultMap="CouponResultMap">
        select * from coupon where cp_id = #{id} and cp_quantity > 0;
    </select>

    <update id="updateCouponQuantity" parameterType="long">
        update coupon
        set cp_quantity = cp_quantity - 1
        where cp_id = #{couponId} and cp_quantity > 0;
    </update>
</mapper>